#
# Operating System
OS = Linux
#OS = Solaris
#OS = AIX

# CPU
CPU = Intel
#CPU = Motorola

#
#
SUBJ = ipynb_conv json_file json2
#
all: $(SUBJ)

#
CC   = gcc
AR   = ar
TH	 = touch
SV   = svn

LIB_PATH = ..

LIB_DIR = $(LIB_PATH)/JunkBox_Lib
LIB_BSC_DIR = $(LIB_DIR)/Lib
LIB_EXT_DIR = $(LIB_DIR)/xLib

LIB_BSC = $(LIB_BSC_DIR)/libbasic.a
LIB_EXT = $(LIB_EXT_DIR)/libextend.a

#DEBUG = -DEBUG

CFLAGS  = -fPIC -DHAVE_CONFIG_H -I$(LIB_DIR) -I$(LIB_BSC_DIR) -I$(LIB_EXT_DIR) -D$(OS) -D$(CPU) $(DEBUG)

SLIB = -L$(LIB_BSC_DIR) -lbasic -lm
ELIB = -L$(LIB_EXT_DIR) -lextend
#
#
$(LIB_DIR)/config.sh :
	(cd $(LIB_PATH) && $(SV) co http://www.nsl.tuis.ac.jp/svn/linux/JunkBox_Lib/trunk JunkBox_Lib)

$(LIB_DIR)/configure: $(LIB_DIR)/config.sh
	(cd $(LIB_DIR) && ./config.sh)

$(LIB_DIR)/Makefile: $(LIB_DIR)/configure
	(cd $(LIB_DIR) && ./configure --enable-ssl)

$(LIB_BSC): $(LIB_DIR)/Makefile
	(cd $(LIB_DIR) && make)

$(LIB_EXT): $(LIB_DIR)/Makefile
	(cd $(LIB_DIR) && make)


.h.c:
	$(TH) $@


.c.o:
	$(CC) $< $(CFLAGS) -c -O2 


clean:
	rm -f *.o *~ $(SUBJ)


#
#
#
#
ipynb_conv: $(LIB_BSC) ipynb_conv.o
	$(CC) $(@).o $(ELIB) $(SLIB) -O2 -o $@   
	strip ipynb_conv
	cp ipynb_conv ../bin

json_file: $(LIB_BSC) json_file.o
	$(CC) $(@).o $(ELIB) $(SLIB) -O2 -o $@ 

json2: $(LIB_BSC) json2.o
	$(CC) $(@).o $(ELIB) $(SLIB) -O2 -o $@ 


